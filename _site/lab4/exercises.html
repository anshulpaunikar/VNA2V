

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  
    <title>Exercises - VNA2V-W21</title>

    
  

  <link rel="shortcut icon" href="http://localhost:4000/VNA2V-W21-handouts/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" href="http://localhost:4000/VNA2V-W21-handouts/assets/css/just-the-docs.css">
  <script src="https://use.fontawesome.com/d81b2d50d8.js"></script>
  
  

  
    <script type="text/javascript" src="http://localhost:4000/VNA2V-W21-handouts/assets/js/vendor/lunr.min.js"></script>
  
  <script type="text/javascript" src="http://localhost:4000/VNA2V-W21-handouts/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Exercises | VNA2V-W21</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Exercises" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AEROSP 740 - Visual Navigation for Autonomous Aerial Vehicles (W21)" />
<meta property="og:description" content="AEROSP 740 - Visual Navigation for Autonomous Aerial Vehicles (W21)" />
<link rel="canonical" href="http://localhost:4000/VNA2V-W21-handouts/lab4/exercises" />
<meta property="og:url" content="http://localhost:4000/VNA2V-W21-handouts/lab4/exercises" />
<meta property="og:site_name" content="VNA2V-W21" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/VNA2V-W21-handouts/lab4/exercises","headline":"Exercises","description":"AEROSP 740 - Visual Navigation for Autonomous Aerial Vehicles (W21)","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  
<script>
  window.MathJax = {
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    },
    loader: {
      load: ['input/tex', '[tex]/ams', '[tex]/configMacros']
    },
    tex: {
      packages: {'[+]': ['boldsymbol', 'ams', 'configMacros']},
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [["$$", "$$"], ["\\[","\\]"]],
      processEscapes: true,
      tags: "ams",
      macros: {
        SE: ['\\mathrm{SE}(#1)', 1],
        SO: ['\\mathrm{SO}(#1)', 1],
        argmin: '\\mathop{\\operatorname{argmin}}',
        argmax: '\\mathop{\\operatorname{argmax}}',
        trace: '\\operatorname{trace}',
        tran: '^{\\mathsf{T}}',
      },
    },
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" async></script>


<script type="text/javascript" src="http://localhost:4000/VNA2V-W21-handouts/assets/js/vendor/lazysizes.min.js" async=""></script>

</head>

<body>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>

        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
            tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            processEscapes: true},
            jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
            extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "[Contrib]/a11y/accessibility-menu.js"],
            TeX: {
            extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"],
            equationNumbers: {
            autoNumber: "AMS"
            }
            }
            });
            </script>

  <div class="page-wrap">
    <div class="side-bar">
      <div class="site-header">
        <a href="http://localhost:4000/VNA2V-W21-handouts" class="site-title lh-tight">VNA2V-W21</a>
        <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button>
      </div>

      <div class="navigation main-nav js-main-nav">
        <nav role="navigation" aria-label="Main navigation">
  <ul class="navigation-list">
<li class="navigation-list-item"><a href="http://localhost:4000/VNA2V-W21-handouts/" class="navigation-list-link">Home</a></li>
<li class="navigation-list-item">
<a href="http://localhost:4000/VNA2V-W21-handouts/lab1/" class="navigation-list-link">Lab 1</a><ul class="navigation-list-child-list ">
<li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab1/ubuntu" class="navigation-list-link">Install Ubuntu 18.04</a></li>
<li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab1/shell" class="navigation-list-link">Shell basics</a></li>
<li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab1/git" class="navigation-list-link">Git</a></li>
<li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab1/cpp" class="navigation-list-link">C++</a></li>
<li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab1/exercises" class="navigation-list-link">Exercises</a></li>
</ul>
</li>
<li class="navigation-list-item">
<a href="http://localhost:4000/VNA2V-W21-handouts/lab2/" class="navigation-list-link">Lab 2</a><ul class="navigation-list-child-list ">
<li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab2/ros" class="navigation-list-link">Installing ROS</a></li>
<li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab2/ros101" class="navigation-list-link">Introduction to ROS</a></li>
<li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab2/exercises" class="navigation-list-link">Exercises</a></li>
</ul>
</li>
<li class="navigation-list-item">
<a href="http://localhost:4000/VNA2V-W21-handouts/lab3/" class="navigation-list-link">Lab 3</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab3/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item active">
<a href="http://localhost:4000/VNA2V-W21-handouts/lab4/" class="navigation-list-link">Lab 4</a><ul class="navigation-list-child-list "><li class="navigation-list-item  active"><a href="http://localhost:4000/VNA2V-W21-handouts/lab4/exercises" class="navigation-list-link active">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="http://localhost:4000/VNA2V-W21-handouts/lab5/" class="navigation-list-link">Lab 5</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab5/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="http://localhost:4000/VNA2V-W21-handouts/lab6/" class="navigation-list-link">Lab 6</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab6/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="http://localhost:4000/VNA2V-W21-handouts/lab7/" class="navigation-list-link">Lab 7</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab7/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="http://localhost:4000/VNA2V-W21-handouts/lab8/" class="navigation-list-link">Lab 8</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/VNA2V-W21-handouts/lab8/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item"><a href="http://localhost:4000/VNA2V-W21-handouts/about" class="navigation-list-link">How to print</a></li>
</ul>
</nav>

      </div>
      <footer class="site-footer">
        <p class="text-small text-grey-dk-000 mb-4"><b>Last modified</b>:<br> Thursday, March 18 at 17:09</p>
      </footer>
    </div>
    <div class="main-content-wrap js-main-content" tabindex="0">
      <div class="main-content">
        <div class="page-header js-page-header">
          
          <div class="search">
            <div class="search-input-wrap">
              <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search VNA2V-W21" aria-label="Search VNA2V-W21" autocomplete="off">
              <svg width="14" height="14" viewbox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title>
<g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"></path><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"></path></g></svg>
            </div>
            <div class="js-search-results search-results-wrap"></div>
          </div>
          
          
        </div>
        <div class="page">
          
            
              <nav class="breadcrumb-nav">
                <ol class="breadcrumb-nav-list">
                  
                    <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/VNA2V-W21-handouts/lab4/">Lab 4</a></li>
                  
                  <li class="breadcrumb-nav-list-item"><span>Exercises</span></li>
                </ol>
              </nav>
            
          
          <div id="main-content" class="page-content" role="main">
            
              <h1 class="no_toc text-delta fs-9" id="exercises">
        
        
          <a href="#exercises" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Exercises
        
        
      </h1>

<ol id="markdown-toc">
  <li>
<a href="#submission" id="markdown-toc-submission">Submission</a>    <ol>
      <li><a href="#individual" id="markdown-toc-individual">Individual</a></li>
      <li><a href="#team" id="markdown-toc-team">Team</a></li>
    </ol>
  </li>
  <li>
<a href="#-individual" id="markdown-toc--individual">👤 Individual</a>    <ol>
      <li><a href="#-deliverable-1---single-segment-trajectory-optimization-20-pts" id="markdown-toc--deliverable-1---single-segment-trajectory-optimization-20-pts">📨 Deliverable 1 - Single-segment trajectory optimization (20 pts)</a></li>
      <li><a href="#-deliverable-2---multi-segment-trajectory-optimization-15-pts" id="markdown-toc--deliverable-2---multi-segment-trajectory-optimization-15-pts">📨 Deliverable 2 - Multi-segment trajectory optimization (15 pts)</a></li>
    </ol>
  </li>
  <li>
<a href="#-team" id="markdown-toc--team">👥 Team</a>    <ol>
      <li>
<a href="#-deliverable-3---drone-racing-65-pts" id="markdown-toc--deliverable-3---drone-racing-65-pts">📨 Deliverable 3 - Drone Racing (65 pts)</a>        <ol>
          <li><a href="#getting-the-codebase" id="markdown-toc-getting-the-codebase">Getting the codebase</a></li>
          <li><a href="#journey-of-a-thousand-miles-starts-with-a-single-step" id="markdown-toc-journey-of-a-thousand-miles-starts-with-a-single-step">Journey of a thousand miles starts with a single step</a></li>
          <li><a href="#waypoint-publishing" id="markdown-toc-waypoint-publishing">Waypoint publishing</a></li>
          <li><a href="#trajectory-generation-and-following" id="markdown-toc-trajectory-generation-and-following">Trajectory generation and following</a></li>
          <li><a href="#ready-go" id="markdown-toc-ready-go">Ready, go!</a></li>
          <li><a href="#optional-faster-faster-extra-credit-15-pts" id="markdown-toc-optional-faster-faster-extra-credit-15-pts">[Optional] Faster, faster (Extra credit: 15 pts)</a></li>
        </ol>
      </li>
    </ol>
  </li>
</ol>
    
      <h1 id="submission">
        
        
          <a href="#submission" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Submission
        
        
      </h1>
    
      <h3 id="individual">
        
        
          <a href="#individual" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Individual
        
        
      </h3>

<p>Create a folder called <code class="highlighter-rouge">lab4</code> that includes your answers (for math-related questions LaTeX is preferred but handwritten is accepted too). Zip the folder and upload on Canvas.</p>

<p><strong>Each student needs to submit their own <code class="highlighter-rouge">lab4</code> folder to Canvas.</strong></p>
    
      <h3 id="team">
        
        
          <a href="#team" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Team
        
        
      </h3>

<p>Each group should create a new folder called <code class="highlighter-rouge">TEAM_&lt;N&gt;</code>, replacing <code class="highlighter-rouge">&lt;N&gt;</code> with your team number. For example team 2 will name their folder <code class="highlighter-rouge">TEAM_2</code>. Please put the source code of the entire <code class="highlighter-rouge">planner_pkg</code> and <code class="highlighter-rouge">trajectory_generation_pkg</code> package in the folder <code class="highlighter-rouge">TEAM_2</code>. Zip the folder and submit to Canvas.</p>

<p><strong>Each team will only need to submit one <code class="highlighter-rouge">TEAM_&lt;N&gt;.zip</code> to Canvas.</strong></p>

<p><strong>Deadline:</strong> To submit your solution, please upload the corresponding files under <code class="highlighter-rouge">Assignment &gt; Lab 4</code> by <strong>Saturday, Feb 20 11:59 EST</strong>.</p>
    
      <h1 id="-individual">
        
        
          <a href="#-individual" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 👤 Individual
        
        
      </h1>
    
      <h2 id="-deliverable-1---single-segment-trajectory-optimization-20-pts">
        
        
          <a href="#-deliverable-1---single-segment-trajectory-optimization-20-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 Deliverable 1 - Single-segment trajectory optimization (20 pts)
        
        
      </h2>

<p>Consider the following minimum velocity ($r=1$) single-segment trajectory optimization problem:</p>

<!-- \begin{eqnarray}
\min_{P(t)} \quad  \int_0^1 (P^{(1)}(t))^2 dt, \label{eq:minvel} \\\
s.t.   \quad P(0) = 0, \label{eq:initpos} \\\
       \quad P(1) = 1, \label{eq:finalpos} 
\end{eqnarray} -->

<p>\begin{equation}
\min_{P(t)} \quad  \int_0^1 (P^{(1)}(t))^2 dt, \label{eq:minvel}
\end{equation}</p>

<p>\begin{equation}
s.t.   \quad P(0) = 0, \label{eq:initpos}
\end{equation}</p>

<p>\begin{equation}
\quad P(1) = 1, \label{eq:finalpos} 
\end{equation}</p>

<p>with $P(t) \in \mathbb{R}[t]$, i.e., $P(t)$ is a polynomial function in $t$ with real coefficients:</p>

<p>\begin{equation}
P(t) = p_N t^N + p_{N-1} t^{N-1} + \dots + p_1 t + p_0.
\end{equation}</p>

<p>Note that because of constraint (\ref{eq:initpos}), we have $P(0)=p_0=0$, and we can parametrize $P(t)$ without a scalar part $p_0$.</p>

<p><em>1.</em> Suppose we restrict $P(t) = p_1 t$ to be a polynomial of degree 1, what is the optimal solution of problem (\ref{eq:minvel})? What is the value of the cost function at the optimal solution?</p>

<!-- **Solution**: From $P(1) = 1$, we have $p_1 = 1$. Therefore, $P(t) = t$, $P^{(1)}(t) = 1$, and the value of the cost function is $\int_0^1 1^2 \cdot dt = 1$.     -->

<p><em>2.</em> Suppose now we allow $P(t)$ to have degree 2, i.e., $P(t) = p_2t^2 + p_1 t$.</p>

<p><em>(a)</em> Write $\int_0^1 (P^{(1)}(t))^2 dt$, the cost function of problem (\ref{eq:minvel}), as $\boldsymbol{p}^T \boldsymbol{Q} \boldsymbol{p}$, where $\boldsymbol{p} = [p_1,p_2]^T$ and $\boldsymbol{Q} \in \mathcal{S}^2$ is a symmetric $2\times 2$ matrix.</p>

<!-- - {: .hint} Hint: $P^{(1)}(t) = p_1 + p_2 \cdot (2t) = \boldsymbol{p}^T[1,2t]^T$, therefore:

\begin{equation}
\int_0^1 (P^{(1)}(t))^2 dt = \int_0^1 \boldsymbol{p}^T 
\left[\begin{array}{c} 1 \\\
2t \end{array}\right]
\left[\begin{array}{cc} 1 & 2t \end{array}\right] \boldsymbol{p} dt 
= \boldsymbol{p}^T \left( \int_0^1 \left[\begin{array}{cc}1 & 2t \\\ 2t & 4t^2 \end{array}\right] dt \right)\boldsymbol{p}
\end{equation} -->

<!-- **Solution**: 
\begin{equation}
\boldsymbol{Q} = \left[ \begin{array}{cc} 1 & 1 \\\ 1 & \frac{4}{3} \end{array} \right].
\end{equation} -->

<p><em>(b)</em> Write $P(1) = 1$, constraint (\ref{eq:finalpos}), as $\boldsymbol{A}\boldsymbol{p} = \boldsymbol{b}$, where $\boldsymbol{A} \in \mathbb{R}^{1 \times 2}$ and $\boldsymbol{b} \in \mathbb{R}$.</p>

<!-- **Solution**: 
\begin{equation}
\boldsymbol{A} = \left[ \begin{array}{cc} 1 & 1 \end{array} \right], \boldsymbol{b} = 1.
\end{equation} -->

<p><em>(c)</em> Solve the Quadratic Program (QP):
\begin{equation}
\min_{\boldsymbol{p}} \boldsymbol{p}^T \boldsymbol{Q} \boldsymbol{p} \quad s.t. \quad \boldsymbol{A} \boldsymbol{p} = \boldsymbol{b}. \label{eq:QPtrajOpt}
\end{equation}
You can solve it by hand, or you can solve it using numerical QP solvers (e.g., you can easily use the <a href="https://www.mathworks.com/help/optim/ug/quadprog.html" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">quadprog</code></a> function in Matlab). What is the optimal solution you get for $P(t)$, and what is the value of the cost function at the optimal solution? Are you able to get a lower cost by allowing $P(t)$ to have degree 2?</p>

<!-- **Solution**: $P^\star(t) = t$, same result as in 1. -->

<p><em>3.</em> Now suppose we allow $P(t) = p_3t^3 + p_2 t^2 + p_1 t$:</p>

<p><em>(a)</em> Let $\boldsymbol{p} = [p_1,p_2,p_3]^T$, write down $\boldsymbol{Q} \in \mathcal{S}^3, \boldsymbol{A} \in \mathbb{R}^{1\times 3}, \boldsymbol{b} \in \mathbb{R}$ for the QP (\ref{eq:QPtrajOpt}).</p>

<!-- **Solution**: $P^{(1)}(t) = p_1 + p_2 \cdot (2t) + p_3 \cdot (3t^2)$. Therefore, we have:
\begin{equation}
\boldsymbol{Q} = \int_0^1 \left[\begin{array}{c} 1 \\\ 2t \\\ 3t^2 \end{array}\right]
\left[\begin{array}{ccc} 1 & 2t & 3t^2 \end{array}\right] dt =
\int_0^1 \left[\begin{array}{ccc} 1 & 2t & 3t^2 \\\ 2t & 4t^2 & 6t^3 \\\ 3t^2 & 6t^3 & 9t^4 \end{array}\right] dt = 
\left[\begin{array}{ccc} 1 & 1 & 1 \\\ 1 & \frac{4}{3} & \frac{3}{2} \\\ 1 & \frac{3}{2} & \frac{9}{5} \end{array}\right].
\end{equation}
In addition, we have:
\begin{equation}
\boldsymbol{A} = [1,1,1], \boldsymbol{b} = 1.
\end{equation} -->

<p><em>(b)</em> Solve the QP, what optimal solution do you get? Do this example agree with the result we learned from Euler-Lagrange equation in class?</p>

<!-- **Solution**: $P^\star(t) = t$, agrees with Euler-Lagrange equation. -->

<p><em>4.</em> Now suppose we are interested in adding one more constraint to problem (\ref{eq:minvel}):</p>

<p>\begin{eqnarray}
\min_{P(t)} \quad  \int_0^1 (P^{(1)}(t))^2 dt, \label{eq:minveladd} \\
s.t.   \quad P(0) = 0, \\
       \quad P(1) = 1, \\
       \quad P^{(1)}(1) = -2.
\end{eqnarray}
Using the QP method above, find the optimal solution and optimal cost of problem (\ref{eq:minveladd}) in the case of:</p>

<p><em>(a)</em> $P(t) = p_2t^2 + p_1  t$, and</p>

<p><em>(b)</em> $P(t) = p_3t^3 + p_2 t^2 + p_1t$.</p>

<!-- **Solution**: 

(a): $P^\star(t) = -3t^2 + 4t$, optimal cost 3.

(b): $P^\star(t) = -3.75t^3 + 4.5t^2 + 0.25t$, optimal cost 2.125. -->
    
      <h2 id="-deliverable-2---multi-segment-trajectory-optimization-15-pts">
        
        
          <a href="#-deliverable-2---multi-segment-trajectory-optimization-15-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 Deliverable 2 - Multi-segment trajectory optimization (15 pts)
        
        
      </h2>

<p><em>1.</em> Assume our goal is to compute the minimum snap trajectory ($r= 4$) over $k$ segments. How many and which type of constraints (at the intermediate points and at the start and end of the trajectory) do we need in order to solve this problem? Specify the number of waypoint constraints, free derivative constraints and fixed derivative constraints.</p>

<ul>
  <li class="hint">Hint: According to Euler-Lagrange method, what is the degree of the polynomial of each segment?</li>
  <li class="hint">Hint: How many unknown parameters do we need to solve?</li>
  <li class="hint">Hint: How many constraints does each waypoint/free derivative/fixed derivative constraint provide?</li>
  <li class="hint">Hint: See figure for $k=3$ as described in the lecture notes.</li>
</ul>

<p><img src="http://localhost:4000/VNA2V-W21-handouts/assets/images/lab4/trajOpt.png" alt="Minimum snap trajectory" class="mx-auto d-block img-size-90"></p>

<p><em>2.</em> Can you extend the previous question to the case in which the cost functional minimizes the $r$-th derivative and we have $k$ segments?</p>
    
      <h1 id="-team">
        
        
          <a href="#-team" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 👥 Team
        
        
      </h1>
    
      <h2 id="-deliverable-3---drone-racing-65-pts">
        
        
          <a href="#-deliverable-3---drone-racing-65-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 Deliverable 3 - Drone Racing (65 pts)
        
        
      </h2>

<p>For this lab we will be racing our simulated quadcopters in a drone racing course we prepared in our Unity simulator!</p>
<ul>
  <li>Implement all the missing parts in the code (labeled as Part 0, Part 1.1, Part 1.2, and Part 1.3, see below)</li>
  <li>A video showing the quadrotor completing the race course. Please upload the video onto either Google drive or Dropbox, generate a publicly viewable link, and put the link in a text file called <code class="highlighter-rouge">rviz_drone_race.txt</code> in your repo.</li>
  <li>A rosbag of your complete and fastest run. Upload the rosbag onto either Google drive or Dropbox, generate a publicly viewable link, and put the link also in <code class="highlighter-rouge">rviz_drone_race.txt</code>. To record the rosbag,
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>rosbag record /current_state /desired_state
</code></pre></div>    </div>
  </li>
</ul>
    
      <h3 id="getting-the-codebase">
        
        
          <a href="#getting-the-codebase" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Getting the codebase
        
        
      </h3>

<!-- First, let us install some prerequisites. In a terminal, run: -->

<p>Let’s set up our workspace:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># change the folder name according to your setup</span>
<span class="nb">cd</span> ~/labs
git pull
</code></pre></div></div>

<p>In <code class="highlighter-rouge">~/labs/lab4</code> we now have the <code class="highlighter-rouge">planner_pkg</code>, <code class="highlighter-rouge">trajectory_generation_pkg</code>, and <code class="highlighter-rouge">dependencies</code> folders, the first two are ROS packages that you 
will be modifying for this lab, and <code class="highlighter-rouge">dependencies</code> should contain all the dependencies you need for this lab.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> <span class="nt">-r</span> ~/labs/lab4/. ~/vna2v_ws/src
<span class="nb">cd</span> ~/vna2v_ws
</code></pre></div></div>

<p>In your <code class="highlighter-rouge">src</code> folder, you should see the folders: <code class="highlighter-rouge">catkin_simple</code>, <code class="highlighter-rouge">controller_pkg</code>, <code class="highlighter-rouge">tesse-ros-bridge</code>, <code class="highlighter-rouge">planner_pkg</code>, <code class="highlighter-rouge">trajectory_generation_pkg</code>, and <code class="highlighter-rouge">dependencies</code>. Now, compile the new code.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin build
<span class="nb">source </span>devel/setup.bash
</code></pre></div></div>

<p>After doing so, please proceed <a href="https://drive.google.com/file/d/1-1oUnTLP7wDmiaWCku0KNuRABe6pe1K5/view?usp=sharing" target="_blank" rel="noopener noreferrer">here</a> to download the new  binary executable for the simulator we are going to use for lab 4. 
Unzip the file, put the folder in <code class="highlighter-rouge">~/vna2v-builds</code>, and run the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/vna2v-builds/vna2v-2021-lab4/
<span class="nb">chmod</span> +x vna2v-2021-lab4.x86_64
</code></pre></div></div>
<p>Try launch the simulator, the simulator should look like this
<img src="http://localhost:4000/VNA2V-W21-handouts/assets/images/lab4/unity_race_course.png" alt="Unity example" class="mx-auto d-block img-size-90"></p>

<p>Before you start coding, keep in mind that the system we are aiming for is as follows. 
Pieces are coming together and we are getting closer and closer to the full system that we have seen so often in class!
<img src="http://localhost:4000/VNA2V-W21-handouts/assets/images/lab4/lab4_diagram.jpg" alt="System diagram" class="mx-auto d-block img-size-120"></p>
    
      <h3 id="journey-of-a-thousand-miles-starts-with-a-single-step">
        
        
          <a href="#journey-of-a-thousand-miles-starts-with-a-single-step" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Journey of a thousand miles starts with a single step
        
        
      </h3>

<p>As a warm up exercise, let’s just fly and hover at the first gate! Follow the instructions for Part 0 inside <code class="highlighter-rouge">planner_pkg/src/simple_traj_planner.cpp</code></p>

<p>Now fire up the simulator and test. In one terminal window, run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/vna2v-builds/vna2v-2021-lab4/
./vna2v-2021-lab4.x86_64
</code></pre></div></div>
<p>In another terminal, launch <code class="highlighter-rouge">tesse_ros_bridge</code> to connect ROS to the simulator,</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch tesse_ros_bridge tesse_quadrotor_bridge.launch
</code></pre></div></div>
<p>Finally launch the test to hover at the first gate</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch planner_pkg static_point_test.launch
</code></pre></div></div>
<ul>
  <li class="hint">Hint: you can press <code class="highlighter-rouge">r</code> to respawn your quadcopter</li>
  <li class="hint">Hint: review the handout from lab 3 if you have trouble running the simulator.</li>
</ul>
    
      <h3 id="waypoint-publishing">
        
        
          <a href="#waypoint-publishing" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Waypoint publishing
        
        
      </h3>

<p>We have already written this node for you in <code class="highlighter-rouge">planner_pkg/src/traj_vertices_publisher.cpp</code>. 
What we are doing here is reading the position and orientation of the gates in the racing course 
and publishing them as waypoints for trajectory optimization. 
The topic to note here is <code class="highlighter-rouge">/desired_traj_vertices</code>, which should contain a <code class="highlighter-rouge">geometry_msgs::PoseArray</code> type
storing the position and orientation of the gates on the racing course.</p>
    
      <h3 id="trajectory-generation-and-following">
        
        
          <a href="#trajectory-generation-and-following" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Trajectory generation and following
        
        
      </h3>

<p>Follow the instructions for Part 1 in <code class="highlighter-rouge">trajectory_generation_pkg/src/trajectory_generation_node.cpp</code> to get your quadcopter ready for drone racing! 
This node will subscribe to the waypoints published and use them for trajectory optimization 
using the <a href="https://github.com/ethz-asl/mav_trajectory_generation" target="_blank" rel="noopener noreferrer">mav_trajectory_generation library</a>, and then based on the trajectory, publish 
the desired state at time t to your controller.</p>

<ul>
  <li class="hint">Hint: use <code class="highlighter-rouge">vertex.addConstraint(POSITION, position)</code> where position is of type <code class="highlighter-rouge">Eigen::Vector3d</code> to enforce a waypoint position.</li>
  <li class="hint">Hint: use <code class="highlighter-rouge">vertex.addConstraint(ORIENTATION, yaw)</code> where yaw is a double to enforce a waypoint yaw.</li>
  <li class="hint">Hint: remember angle wraps around 2$\pi$. Be careful!</li>
  <li class="hint">Hint: for the ending waypoint for position use <code class="highlighter-rouge">end_vertex.makeStartOrEnd</code> as seen with the starting waypoint instead of <code class="highlighter-rouge">vertex.addConstraint</code> as you would do for the other waypoints.</li>
</ul>
    
      <h3 id="ready-go">
        
        
          <a href="#ready-go" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Ready, go!
        
        
      </h3>

<p>Now we are ready to race! Fire up the virtual race course.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/vna2v-builds/vna2v-2021-lab4/
./vna2v-2021-lab4.x86_64
</code></pre></div></div>
<p>In another terminal, launch <code class="highlighter-rouge">tesse_ros_bridge</code> to connect ROS to the simulator,</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch tesse_ros_bridge tesse_quadrotor_bridge.launch
</code></pre></div></div>
<p>Launch the trajectory follower,</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch trajectory_generation traj_following.launch
</code></pre></div></div>
<p>And finally, launch the waypoint publisher</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch planner_pkg traj_gen.launch
</code></pre></div></div>

<p>If everything is working well, your drone should be gracefully going through each gate like this</p>

<p><img data-src="http://localhost:4000/VNA2V-W21-handouts/assets/images/lab4/drone_aero_race.gif" class="lazyload mx-auto d-block"></p>

<p><strong>Note</strong>: If the quadcopter flips over after launching the trajectory follower, press <code class="highlighter-rouge">r</code> in the Unity window to respwan, the quadcopter should just go back to the starting position.</p>
    
      <h3 id="optional-faster-faster-extra-credit-15-pts">
        
        
          <a href="#optional-faster-faster-extra-credit-15-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> [Optional] Faster, faster (Extra credit: 15 pts)
        
        
      </h3>

<p>How can you make the drone go faster? We will award extra credit to the fastest 3 teams!</p>
            

          

          
            <hr>
            <footer role="contentinfo">
              <p class="text-small text-grey-dk-000 mb-0">Enabled with the generous support of the MIT SPARK Lab. Copyright © MIT SPARK Lab and Vasileios Tzoumas of the University of Michigan. Using <a href="https://github.com/pmarsceill/just-the-docs/tree/master" target="_blank" rel="noopener noreferrer">Just the docs</a> theme.</p>
            </footer>
          

        </div>
      </div>
    </div>
  </div>

</div></body>
</html>
